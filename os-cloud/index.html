
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Building automation of a virtual machine (VM) from a server install image of ubuntu (ISO file)">
      
      
        <meta name="author" content="Daniel Jacob">
      
      
      
        <link rel="prev" href="../finalvm/">
      
      
        <link rel="next" href="../google-cloud/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Openstack Cloud - Using JupyterHub within a VM and on the Cloud</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../css/pdfextra.css">
    
      <link rel="stylesheet" href="../css/lightbox.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#openstack-cloud" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Using JupyterHub within a VM and on the Cloud" class="md-header__button md-logo" aria-label="Using JupyterHub within a VM and on the Cloud" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Using JupyterHub within a VM and on the Cloud
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Openstack Cloud
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Using JupyterHub within a VM and on the Cloud" class="md-nav__button md-logo" aria-label="Using JupyterHub within a VM and on the Cloud" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Using JupyterHub within a VM and on the Cloud
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../basebox/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building the Base VM
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../finalvm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building the Final VM
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Using the Final VM on an Openstack cloud
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Using the Final VM on an Openstack cloud
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#retrieving-its-connection-settings-from-genouest-openstack" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retrieving its connection settings from GenOuest Openstack
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-image-on-the-openstack-infrastructure" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating the image on the openstack infrastructure
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-an-instance-from-the-created-image" class="md-nav__link">
    <span class="md-ellipsis">
      
        Creating an instance from the created image
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acknowledgements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Acknowledgements
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-cloud/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Using the Final VM on Google Cloud Platform
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="openstack-cloud">Openstack Cloud<a class="headerlink" href="#openstack-cloud" title="Permanent link">&para;</a></h1>
<style>.md-typeset h1 {display: none;} .md-nav__item {font-size: medium}</style>

<p><a href="https://www.genouest.org/" target="_blank">GenOuest</a> is a national bioinformatics platform federated by the <a href="https://www.france-bioinformatique.fr/" target="_blank">French Institute of Bioinformatics</a> (IFB). This platform offers cloud services for the French public research community. Any researcher from this community can make a request to Genouest or any other IFB platform to have access to the proposed services.</p>
<p>GenOuest offers on its datacenter infrastructure a service of providing computing resources in the form of virtual machines. The infrastructure is managed using <a href="https://www.openstack.org/" target="_blank">Openstack</a>, which is a set of open source software that allows the deployment of cloud computing infrastructures (Infrastructure as a Service, IaS). It is therefore necessary to have a valid account on this infrastructure (see the <a href="https://help.genouest.org/" target="_blank">online help</a>).</p>
<p>It is then assumed that you have installed Python (â‰¥2.7) as well as the <a href="https://docs.openstack.org/newton/user-guide/common/cli-install-openstack-command-line-clients.html" target="_blank">package python-openstackclient</a> . </p>
<p><br></p>
<h4 id="retrieving-its-connection-settings-from-genouest-openstack">Retrieving its connection settings from GenOuest Openstack<a class="headerlink" href="#retrieving-its-connection-settings-from-genouest-openstack" title="Permanent link">&para;</a></h4>
<p>To set the required environment variables for openstack command line clients, you must download the environment file called openrc.sh from the <a href="https://www.youtube.com/embed/XcQYz--CNiM?ab_channel=UKCloudLtd" target="_blank">GenOuest openStack dashboard</a> as a user. This project-specific environment file contains the credentials that all openstack services use.</p>
<p><br></p>
<center>
<a href="../images/image3.png" data-lightbox="image3"><img src="../images/image3.png" width="600px"></a>
</center>
<p><br><br></p>
<p><strong>Note</strong>: All the scripts and other configuration files mentioned in this description can be found in free access under the <a href="https://github.com/inrae/jupyterhub-vm/tree/master/openstack" target="_blank">GiHub INRAE repository</a>.</p>
<p><br></p>
<p>You need to get the <em>openrc.sh</em> script as well as the <em>cloud.yml</em> configuration file. The latter is to be put in the <em>&lt;home directory&gt;/.config/openstack</em> directory.</p>
<p>Then run the <em>openrc.sh</em> script in the current shell (i.e invoking using a dot); you will be asked for your password.</p>
<div class="highlight"><pre><span></span><code>$&gt;<span class="w"> </span>.<span class="w"> </span>./openrc.sh
Please<span class="w"> </span>enter<span class="w"> </span>your<span class="w"> </span>OpenStack<span class="w"> </span>Password<span class="w"> </span><span class="k">for</span><span class="w"> </span>project<span class="w"> </span>&lt;Project&gt;<span class="w"> </span>as<span class="w"> </span>user<span class="w"> </span>&lt;Users&gt;:
</code></pre></div>
<ul>
<li><em>&lt;Project&gt;</em> and <em>&lt;User&gt;</em> corresponding to your configuration.</li>
</ul>
<p>This script will define the following variables: OS_AUTH_URL, OS_PROJECT_DOMAIN_ID, OS_REGION_NAME, OS_PROJECT_NAME, OS_USER_DOMAIN_NAME, OS_IDENTITY_API_VERSION, OS_INTERFACE, OS_USERNAME, OS_PROJECT_ID, OS_PASSWORD</p>
<p>In addition, in order to simplify the written of commands, we will define some aliases.</p>
<div class="highlight"><pre><span></span><code><span class="nv">OS_SCRIPTS</span><span class="o">=</span>&lt;path<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>python-openstackclient<span class="w"> </span>scripts&gt;

<span class="nb">alias</span><span class="w"> </span><span class="nv">ostack</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$OS_SCRIPTS</span><span class="s2">/openstack --os-cloud=openstack --os-password </span><span class="nv">$OS_PASSWORD</span><span class="s2">&quot;</span>
<span class="nb">alias</span><span class="w"> </span><span class="nv">onova</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$OS_SCRIPTS</span><span class="s2">/nova --os-password </span><span class="nv">$OS_PASSWORD</span><span class="s2">&quot;</span>
</code></pre></div>
<p><br></p>
<p>If everything is configured correctly, the following command should provide you with a list of available flavors. Flavours define the hardware configuration available for a server. It defines the size of a virtual server that can be started.</p>
<p><div class="highlight"><pre><span></span><code>$&gt;<span class="w"> </span>ostack<span class="w"> </span>flavor<span class="w"> </span>list
</code></pre></div>
<div class="highlight"><pre><span></span><code>+------------+-------+------+-------+-----------+
 | Name       |   RAM | Disk | VCPUs | Is Public |
 +------------+-------+------+-------+-----------+
 | m2.xlarge  | 16384 |   20 |     4 | True      |
 | m1.small   |  2048 |   20 |     1 | True      |
 | m2.large   |  8192 |   20 |     2 | True      |
 | m1.medium  |  4096 |   20 |     2 | True      |
 | m2.4xlarge | 65536 |   20 |     8 | True      |
 | m2.medium  |  4096 |   20 |     1 | True      |
 | m1.2xlarge | 32768 |   20 |     8 | True      |
 | m1.large   |  8192 |   20 |     4 | True      |
 | m1.xlarge  | 16384 |   20 |     8 | True      |
 | m2.2xlarge | 32768 |   20 |     4 | True      |
 +------------+-------+------+-------+-----------+
</code></pre></div></p>
<p><br></p>
<p>We will then proceed in two steps:</p>
<ol>
<li>create a VM image within the library</li>
<li>create an instance of this image</li>
</ol>
<p><br></p>
<center>
<a href="../images/image4.png" data-lightbox="image4"><img src="../images/image4.png" width="600px"></a>
</center>
<p><br><br></p>
<h4 id="creating-the-image-on-the-openstack-infrastructure">Creating the image on the openstack infrastructure<a class="headerlink" href="#creating-the-image-on-the-openstack-infrastructure" title="Permanent link">&para;</a></h4>
<p>It is first necessary to extract the VM file in VMDK format from the archive generated in the previous step.</p>
<p><div class="highlight"><pre><span></span><code>$&gt;<span class="w"> </span>tar<span class="w"> </span>xvzf<span class="w"> </span>&lt;path<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>archive<span class="w"> </span>file&gt;/ubuntu-box.tar.gz<span class="w"> </span>box-disk001.vmdk
</code></pre></div>
This is the file that will be used to create the image. You must also specify a name for the image. </p>
<p>Then the command below will create the image from the VM file. This command can take several minutes to be achieved.</p>
<div class="highlight"><pre><span></span><code><span class="nv">IMAGE_NAME</span><span class="o">=</span>jupyterhub-image

ostack<span class="w"> </span>image<span class="w"> </span>create<span class="w"> </span>--disk-format<span class="w"> </span>vmdk<span class="w"> </span>--file<span class="w"> </span>box-disk001.vmdk<span class="w"> </span><span class="nv">$IMAGE_NAME</span>

ostack<span class="w"> </span>image<span class="w"> </span><span class="nb">set</span><span class="w"> </span>--property<span class="w"> </span><span class="nv">description</span><span class="o">=</span><span class="s1">&#39;JupyterHub with R and Python&#39;</span><span class="w"> </span><span class="nv">$IMAGE_NAME</span>

ostack<span class="w"> </span>image<span class="w"> </span>show<span class="w"> </span><span class="nv">$IMAGE_NAME</span>
</code></pre></div>
<p>As a result you should obtained something like below:
<div class="highlight"><pre><span></span><code>+------------------+----------------------------------------------------------+
| Field            | Value                                                    |
+------------------+----------------------------------------------------------+
| checksum         | 2a8e9789322009839401be1c25b3d977                         |
| container_format | bare                                                     |
| created_at       | 2021-09-09T06:49:14Z                                     |
| disk_format      | vmdk                                                     |
| file             | /v2/images/d88e2d16-9c67-4f07-a5dd-20d68f80ba0f/file     |
| id               | d88e2d16-9c67-4f07-a5dd-20d68f80ba0f                     |
| min_disk         | 0                                                        |
| min_ram          | 0                                                        |
| name             | jupyterhub-img                                           |
| owner            | xxxxxxxxxxxxxxxxxxxxxxxxxx                               |
| properties       | description=&#39;JupyterHub with R and Python&#39;               |
| protected        | False                                                    |
| schema           | /v2/schemas/image                                        |
| size             | 3666548736                                               |
| status           | active                                                   |
| tags             |                                                          |
| updated_at       | 2021-09-09T07:02:16Z                                     |
| visibility       | shared                                                   |
+------------------+----------------------------------------------------------+
</code></pre></div></p>
<p><br></p>
<h4 id="creating-an-instance-from-the-created-image">Creating an instance from the created image<a class="headerlink" href="#creating-an-instance-from-the-created-image" title="Permanent link">&para;</a></h4>
<p>From the created image, it is now possible to create an instance. You have to specify the name of the instance, its flavor (see above) and the SSH key associated to this VM. The SSH key (keypair) must first have been created from the openstack dashboard.</p>
<ul>
<li>
<p>You can list the SSH keys with the command:
<div class="highlight"><pre><span></span><code>ostack<span class="w"> </span>keypair<span class="w"> </span>list
</code></pre></div></p>
</li>
<li>
<p>An SSH key has been created with the name <em>genostack</em> in the openstack dashboard. This <a href="http://www.genouest.org/outils/genostack/ssh-config.html" target="_blank">SSH key</a> must be a valid key on your (linux) openstack.genouest.org account(file <em>~/.ssh/authorized_keys</em>).</p>
</li>
<li>
<p>For flavor we choose in our example the one corresponding to 8 CPUs, 16GB of RAM and 20GB of disk.</p>
</li>
<li>
<p>You can also specify the file containing the commands to be executed after the first boot. Here this file is necessary (<em><a href="https://github.com/inrae/jupyterhub-vm/blob/master/openstack/user-data-jupystack.txt" target="_blank">user-data-jupystack.txt</a></em>) because we must overwrite the file <em>/usr/local/bin/get-hostname</em> giving the complete name of the instance on openstack in order to build the root URL of the jupyterhub application (cf <em><a href="https://github.com/inrae/jupyterhub-vm/blob/master/ansible/roles/jupyterhub/files/bin/jupyterhub.pre" target="_blank">jupyterhub.pre</a></em> and <em><a href="https://github.com/inrae/jupyterhub-vm/blob/master/ansible/roles/jupyterhub/files/systemd/jupyterhub.service" target="_blank">jupyterhub.service</a></em>).</p>
</li>
</ul>
<p><br></p>
<p>Now, we are ready to launch the command to create the VM isntance.</p>
<div class="highlight"><pre><span></span><code><span class="nv">IMAGE_NAME</span><span class="o">=</span>jupyterhub-image
<span class="nv">SERVER_NAME</span><span class="o">=</span>jupystack
<span class="nv">KEYPAIR</span><span class="o">=</span>genostack
<span class="nv">FLAVOR_NAME</span><span class="o">=</span>m1.xlarge

<span class="nv">IMAGEID</span><span class="o">=</span><span class="k">$(</span>ostack<span class="w"> </span>image<span class="w"> </span>show<span class="w"> </span><span class="nv">$IMAGE_NAME</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>grep<span class="w"> </span><span class="s2">&quot;| id &quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">&#39;|&#39;</span><span class="w"> </span>-f3<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\ </span>
<span class="w">           </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/ //g&quot;</span><span class="k">)</span>
<span class="nv">FLAVORID</span><span class="o">=</span><span class="k">$(</span>ostack<span class="w"> </span>flavor<span class="w"> </span>list<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>grep<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$FLAVOR_NAME</span><span class="s2">&quot;</span><span class="w">  </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-d<span class="s1">&#39;|&#39;</span><span class="w"> </span>-f2<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">           </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/ //g&quot;</span><span class="k">)</span>

onova<span class="w"> </span>boot<span class="w"> </span>--flavor<span class="w"> </span><span class="nv">$FLAVORID</span><span class="w"> </span>--image<span class="w"> </span><span class="nv">$IMAGEID</span><span class="w"> </span>--security-groups<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>--user-data<span class="w"> </span>./user-data-jupystack.txt<span class="w"> </span><span class="se">\</span>
<span class="w">           </span>--key-name<span class="w"> </span><span class="nv">$KEYPAIR</span><span class="w">  </span><span class="nv">$SERVER_NAME</span>
</code></pre></div>
<p>Once launched, the construction of the VM instance is underway, and its status is "building". So you have to wait until the VM status is "Running" (~ one minute or more).</p>
<p>To see the status, launch the command below :</p>
<div class="highlight"><pre><span></span><code>ostack<span class="w"> </span>server<span class="w"> </span>show<span class="w"> </span><span class="nv">$SERVER_NAME</span>
</code></pre></div>
<p>You should probably rereun this last command</p>
<p>Finally you should obtained something like below:</p>
<div class="highlight"><pre><span></span><code>+-----------------------------+---------------------------------------------------------+
| Field                       | Value                                                   |
+-----------------------------+---------------------------------------------------------+
| OS-DCF:diskConfig           | MANUAL                                                  |
| OS-EXT-AZ:availability_zone | nova                                                    |
| OS-EXT-STS:power_state      | Running                                                 |
| OS-EXT-STS:task_state       | None                                                    |
| OS-EXT-STS:vm_state         | active                                                  |
| OS-SRV-USG:launched_at      | 2021-09-09T07:09:49.000000                              |
| OS-SRV-USG:terminated_at    | None                                                    |
| accessIPv4                  |                                                         |
| accessIPv6                  |                                                         |
| addresses                   | genouest-ext=192.168.101.79                             |
| config_drive                | True                                                    |
| created                     | 2021-09-09T07:08:05Z                                    |
| flavor                      | m1.xlarge (c781b97e-f891-4ddf-9a6b-0e5ae4ef3eb1)        |
| hostId                      | 126a5d6324eb3765547b4d2e3c5743509afde064a7d90ff1db2fb58a|
| id                          | 0146be96-0c4f-413b-b3a5-bde37cdabb26                    |
| image                       | jupyterhub-image (d88e2d16-9c67-4f07-a5dd-20d68f80ba0f) |
| key_name                    | genostack                                               |
| name                        | jupystack                                               |
| progress                    | 0                                                       |
| project_id                  | xxxxxxxxxxxxxxxxxxxxxxxxx                               |
| properties                  |                                                         |
| security_groups             | name=&#39;default&#39;                                          |
| status                      | ACTIVE                                                  |
| updated                     | 2021-09-09T07:09:49Z                                    |
| user_id                     | xxxxxxxxxxxxxxxxxxxxxxxxx                               |
| volumes_attached            |                                                         |
+-----------------------------+---------------------------------------------------------+
</code></pre></div>
<p><br></p>
<p>The last command is also used to obtain the IP number of the VM thus created. The IP addresse is given by the field 'addresses'. Let's suppose that this IP number is <em>192.168.101.79</em>.  You can then access the application from your web browser at the URL: <em><a href="https://app-192-168-101-79.vm.openstack.genouest.org/hub/login">https://app-192-168-101-79.vm.openstack.genouest.org/hub/login</a></em></p>
<p><br></p>
<center>
<a href="../images/image5.png" data-lightbox="image5"><img src="../images/image5.png" width="600px"></a>
</center>
<p><br><br></p>
<h3 id="acknowledgements">Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permanent link">&para;</a></h3>
<p>We would like to thank the <a href="https://www.genouest.org/2017/03/02/cluster/" target="_blank">IFB GenOuest bioinformatics</a> for providing storage and computing resources on its national life science Cloud.</p>
<hr />
<ul>
<li><a href="../gcpimg/PuTTY_WinSCP.pdf" target="_blank">Additional document</a>: Slides that show, step by step, how to copy data, scripts and notebooks to the shared folder of the Jupyterhub server, in a secure way (SCP) using PuTTY and WinSCP.</li>
</ul>
<hr />
<p><br><br><br></p>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Daniel Jacob, INRAE, 2021
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["toc.integrate", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="../js/jquery-2.1.1.min.js"></script>
      
        <script src="../js/lightbox.min.js"></script>
      
        <script src="../js/mermaid.min.js"></script>
      
        <script src="../js/extra.js"></script>
      
    
  </body>
</html>