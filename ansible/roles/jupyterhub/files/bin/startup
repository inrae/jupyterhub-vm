#!/bin/bash

MARKER="/var/lib/startup-script.done"
METADATA_URL="http://169.254.169.254/latest/user-data"

[ -f "$MARKER" ] && exit 0

curl --silent --max-time 3 "$METADATA_URL" -o /tmp/script.sh

if [ -s /tmp/script.sh ]; then
    chmod +x /tmp/script.sh
    bash /tmp/script.sh
    touch "$MARKER"
fi

exit 0
